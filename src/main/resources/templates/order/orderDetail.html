<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
	<head>
		<meta charset="utf-8">
		<title></title>
		<style>
			.footBtn {
				position: sticky;
				bottom: 0px;
				padding-top: 5px;
				padding-bottom: 10px;
				width: 100%;
				background-color: #D8D8D8;
				opacity: 0.9;
			}
			.panel-body {
				padding: 5px 0px;
			}
			.profile-info-row {
				padding-left: 0px;
				padding-right: 0px;
			}
		</style>
	</head>
	<body>
		<div class="page-content" style="margin-bottom: 50px; min-height: 800px;">
			<input type="hidden" name="hideOid" id="hideOid" th:value="${orderInfo.oid}" />
			<div class="row" id="">
				<div class="col-xs-6 col-sm-6 col-md-6">
				</div>
				<div class="col-xs-6 col-sm-6 col-md-6" style="padding-bottom: 5px;">
					<button th:onclick="toEnquiry([[${orderInfo.oid}]])" class="btn btn-mini btn-primary">新增询价 </button>
					<button th:onclick="toQuotation([[${orderInfo.oid}]])" class="btn btn-mini btn-primary">报价单 </button>
					<button th:onclick="toBidder([[${orderInfo.oid}]])" class="btn btn-mini btn-primary">新增竞标方 </button>
					<button th:onclick="toDeposit([[${orderInfo.oid}]])" class="btn btn-mini btn-primary">新增保证金 </button>
				</div>
			</div>
			<div class="row">
				<div class="col-xs-11 col-sm-11 col-md-11">
					<div id="accordion" class="panel-group">
						<div class="panel panel-default">
							<div class="panel-heading">
								<a class="accordion-toggle bolder" data-toggle="collapse" href="#collapseOne">
									<i class="ace-icon fa fa-angle-down bigger-110" data-icon-hide="ace-icon fa fa-angle-down" data-icon-show="ace-icon fa fa-angle-right"></i>
									&nbsp;订单基本信息 <span style="color: #B7B7B7;font-size: 12px;">(点击此处可收起)</span> 
								</a>
							</div>

							<div class="panel-collapse collapse in" id="collapseOne">
								<div class="panel-body">
									<div class="profile-user-info profile-user-info-striped">
										<div class="col-xs-6 col-sm-6 col-md-6 profile-info-row">
											<div class="profile-info-name"> 项目名称 </div>
											<div class="profile-info-value">
												<span class="" id="projectName" th:text="${orderInfo?.projectName}"></span>
											</div>
										</div>
										<div class="col-xs-6 col-sm-6 col-md-6 profile-info-row">
											<div class="profile-info-name"> 时间 </div>
											<div class="profile-info-value">
												<span class="" id="otime" th:text="${#dates.format(orderInfo?.ctime, 'yyyy-MM-dd HH:mm:ss')}"></span>
											</div>
										</div>
										<div class="col-xs-6 col-sm-6 col-md-6 profile-info-row">
											<div class="profile-info-name"> 客户 </div>
											<div class="profile-info-value">
												<span class="" id="customerText" th:text="${orderInfo?.customerText}"></span>
											</div>
										</div>
										<div class="col-xs-6 col-sm-6 col-md-6 profile-info-row">
											<div class="profile-info-name"> 区域 </div>
											<div class="profile-info-value">
												<span class="" id="areaText" th:text="${orderInfo?.areaText}"></span>
											</div>
										</div>
										<div class="col-xs-6 col-sm-6 col-md-6 profile-info-row">
											<div class="profile-info-name"> 中标方 </div>
											<div class="profile-info-value">
												<span class="" id="bidderZText" th:text="${orderInfo?.bidderZText}"></span>
											</div>
										</div>
										<div class="col-xs-6 col-sm-6 col-md-6 profile-info-row">
											<div class="profile-info-name"> 来源 </div>
											<div class="profile-info-value">
												<span class="" id="source" th:text="${orderInfo?.source}"></span>
											</div>
										</div>
										<div class="col-xs-6 col-sm-6 col-md-6 profile-info-row">
											<div class="profile-info-name"> 中标金额 </div>
											<div class="profile-info-value">
												<span class="" id="bidAmount" th:text="${orderInfo?.bidAmount}"></span>
											</div>
										</div>
										<div class="col-xs-6 col-sm-6 col-md-6 profile-info-row">
											<div class="profile-info-name"> 明细 </div>
											<div class="profile-info-value">
												<span class="" id="bidDetail" th:text="${orderInfo?.bidDetail}"></span>
											</div>
										</div>
										<div class="col-xs-12 col-sm-12 col-md-12 profile-info-row">
											<div class="profile-info-name"> 备注 </div>
											<div class="profile-info-value">
												<span class="" id="remark" th:text="${orderInfo?.remark}"></span>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div th:if="${!#lists.isEmpty(orderInfo.enquiries)}" class="panel panel-default">
							<div class="panel-heading">
								<a class="accordion-toggle collapsed bolder" data-toggle="collapse" href="#collapseEnquiry">
									<i class="ace-icon fa fa-angle-down bigger-110" data-icon-hide="ace-icon fa fa-angle-down" data-icon-show="ace-icon fa fa-angle-right"></i>
									&nbsp;询价信息<span style="color: #B7B7B7;font-size: 12px;">(点击此处可收起)</span>
								</a>
							</div>
						
							<div class="panel-collapse collapse in" id="collapseEnquiry">
								<div class="panel-body">
									<div id="enquiry-list" style="padding: 2px 12px;">
										<table id="enquiry-table" class="table table-bordered table-hover">
											<thead>
												<tr>
													<th>供应商</th>
													<th>总价</th>
													<th></th>
												</tr>
											</thead>
											<tbody id="enquiry-tbody">
												<tr th:each="enquiry, state: ${orderInfo.enquiries}">
													<td th:text="${enquiry.supplierName}"></td>
													<td th:text="${enquiry.total}"></td>
													<td>
														<button th:onclick="showEnquiryDetail([[${enquiry.eid}]])" class="btn btn-white btn-info btn-mini">明细</button>
													</td>
												</tr>
											</tbody>
										</table>
									</div>
								</div>
							</div>
						</div>
						<div th:if="${orderInfo.quotation}" class="panel panel-default">
							<div class="panel-heading">
								<a class="accordion-toggle collapsed bolder" data-toggle="collapse" href="#collapseQuotation">
									<i class="ace-icon fa fa-angle-down bigger-110" data-icon-hide="ace-icon fa fa-angle-down" data-icon-show="ace-icon fa fa-angle-right"></i>
									&nbsp;报价单<span style="color: #B7B7B7;font-size: 12px;">(点击此处可收起)</span>
								</a>
							</div>
						
							<div class="panel-collapse collapse in" id="collapseQuotation">
								<div class="panel-body">
									<div class="profile-user-info profile-user-info-striped">
										<div class="col-xs-6 col-sm-6 col-md-6 profile-info-row">
											<div class="profile-info-name"> 报价单<small>(发客户)</small> </div>
											<div class="profile-info-value">
												<!-- <span class="" id="customerAnnexName" th:text="${orderInfo.quotation.customerAnnexName}"></span> -->
												<p th:onclick="toDownloadAnnex([[${orderInfo.quotation.customerAnnexPath}]])" style="color: #007DDB;cursor: pointer;" th:on title="点击下载" th:text="${orderInfo.quotation.customerAnnexName}"></p>
											</div>
										</div>
										<div class="col-xs-6 col-sm-6 col-md-6 profile-info-row">
											<div class="profile-info-name"> 明细<small>(自留)</small> </div>
											<div class="profile-info-value">
												<!-- <span class="" id="selfAnnesName" th:text="${orderInfo.quotation.selfAnnesName}"></span> -->
												<p th:onclick="toDownloadAnnex([[${orderInfo.quotation.selfAnnexPath}]])" style="color: #007DDB;cursor: pointer;" th:on title="点击下载" th:text="${orderInfo.quotation.selfAnnesName}"></p>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div class="panel panel-default">
							<div class="panel-heading">
								<a class="accordion-toggle collapsed bolder" data-toggle="collapse" href="#collapseBidder">
									<i class="ace-icon fa fa-angle-down bigger-110" data-icon-hide="ace-icon fa fa-angle-down" data-icon-show="ace-icon fa fa-angle-right"></i>
									&nbsp;竞标参与方<span style="color: #B7B7B7;font-size: 12px;">(点击此处可收起)</span>
								</a>
							</div>
							<div class="panel-collapse collapse in" id="collapseBidder">
								<div class="panel-body">
									<div id="bidder-list" style="padding: 2px 12px;">
										<table id="bidder-table" class="table table-bordered table-hover">
											<thead>
												<tr>
													<th>竞标参与方</th>
													<th>总价</th>
													<th></th>
												</tr>
											</thead>
											<div th:if="${!#lists.isEmpty(orderInfo.bidders)}">
												<tbody id="bidder-tbody">
													<tr th:each="bidder, state: ${orderInfo.bidders}">
														<td th:text="${bidder?.corporateName}"></td>
														<td th:text="${bidder?.total}"></td>
														<td>
															<button th:onclick="showBidderDetail([[${bidder?.bid}]])" class="btn btn-white btn-info btn-mini">明细</button>
														</td>
													</tr>
												</tbody>
											</div>
										</table>
									</div>
								</div>
							</div>
						</div>
						<div class="panel panel-default">
							<div class="panel-heading">
								<a class="accordion-toggle collapsed bolder" data-toggle="collapse" href="#collapseDeposit">
									<i class="ace-icon fa fa-angle-down bigger-110" data-icon-hide="ace-icon fa fa-angle-down" data-icon-show="ace-icon fa fa-angle-right"></i>
									&nbsp;投标保证金<span style="color: #B7B7B7;font-size: 12px;">(点击此处可收起)</span>
								</a>
							</div>
							<div class="panel-collapse collapse in" id="collapseDeposit">
								<div class="panel-body">
									<div id="bidder-list" style="padding: 2px 12px;">
										<table id="bidder-table" class="table table-bordered table-hover">
											<thead>
												<tr>
													<th>缴纳方</th>
													<th>出资方</th>
													<th>金额</th>
													<th>缴纳日期</th>
													<th>是否代缴</th>
													<th>是否收回</th>
													<th>收回日期</th>
													<th></th>
												</tr>
											</thead>
											<div th:if="${!#lists.isEmpty(orderInfo.deposits)}">
												<tbody id="bidder-tbody">
													<tr th:each="depo, state: ${orderInfo.deposits}">
														<td th:text="${depo?.payerName}"></td>
														<td th:text="${depo?.providerName}"></td>
														<td th:text="${depo?.amount}"></td>
														<td th:text="${depo?.payDate}"></td>
														<td th:text="${depo?.forPay}"></td>
														<td th:text="${depo?.isBack}"></td>
														<td th:text="${depo?.backDate}"></td>
														<td>
															<button th:onclick="showDepositDetail([[${depo?.did}]])" class="btn btn-info btn-mini">明细</button>
														</td>
													</tr>
												</tbody>
											</div>
										</table>
									</div>
								</div>
							</div>
						</div>
						<div class="panel panel-default">
							<div class="panel-heading">
								<a class="accordion-toggle bolder" data-toggle="collapse" href="#collapseContract">
									<i class="ace-icon fa fa-angle-down bigger-110" data-icon-hide="ace-icon fa fa-angle-down" data-icon-show="ace-icon fa fa-angle-right"></i>
									&nbsp;合同信息 <span style="color: #B7B7B7;font-size: 12px;">(点击此处可收起)</span> 
								</a>
							</div>
						
							<div class="panel-collapse collapse in" id="collapseContract">
								<div class="panel-body">
									<div class="profile-user-info profile-user-info-striped">
										<div class="col-xs-6 col-sm-6 col-md-6 profile-info-row">
											<div class="profile-info-name"> 项目名称 </div>
											<div class="profile-info-value">
												<span class="" id="projectName" th:text="${orderInfo?.projectName}"></span>
											</div>
										</div>
										<div class="col-xs-6 col-sm-6 col-md-6 profile-info-row">
											<div class="profile-info-name"> 时间 </div>
											<div class="profile-info-value">
												<span class="" id="otime" th:text="${#dates.format(orderInfo?.ctime, 'yyyy-MM-dd HH:mm:ss')}"></span>
											</div>
										</div>
										<div class="col-xs-6 col-sm-6 col-md-6 profile-info-row">
											<div class="profile-info-name"> 客户 </div>
											<div class="profile-info-value">
												<span class="" id="customerText" th:text="${orderInfo?.customerText}"></span>
											</div>
										</div>
										<div class="col-xs-6 col-sm-6 col-md-6 profile-info-row">
											<div class="profile-info-name"> 区域 </div>
											<div class="profile-info-value">
												<span class="" id="areaText" th:text="${orderInfo?.areaText}"></span>
											</div>
										</div>
										<div class="col-xs-6 col-sm-6 col-md-6 profile-info-row">
											<div class="profile-info-name"> 中标方 </div>
											<div class="profile-info-value">
												<span class="" id="bidderZText" th:text="${orderInfo?.bidderZText}"></span>
											</div>
										</div>
										<div class="col-xs-6 col-sm-6 col-md-6 profile-info-row">
											<div class="profile-info-name"> 来源 </div>
											<div class="profile-info-value">
												<span class="" id="source" th:text="${orderInfo?.source}"></span>
											</div>
										</div>
										<div class="col-xs-6 col-sm-6 col-md-6 profile-info-row">
											<div class="profile-info-name"> 中标金额 </div>
											<div class="profile-info-value">
												<span class="" id="bidAmount" th:text="${orderInfo?.bidAmount}"></span>
											</div>
										</div>
										<div class="col-xs-6 col-sm-6 col-md-6 profile-info-row">
											<div class="profile-info-name"> 明细 </div>
											<div class="profile-info-value">
												<span class="" id="bidDetail" th:text="${orderInfo?.bidDetail}"></span>
											</div>
										</div>
										<div class="col-xs-12 col-sm-12 col-md-12 profile-info-row">
											<div class="profile-info-name"> 备注 </div>
											<div class="profile-info-value">
												<span class="" id="remark" th:text="${orderInfo?.remark}"></span>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="footBtn">
			<div class="container-fluid">
				<div class="row">
					<div class="col-xs-5 col-sm-5 col-md-5"></div>
					<div class="">
						<button class="btn btn-white btn-default" onclick="closeOpen()"> 关 &nbsp; 闭</button>
					</div>
				</div>
			</div>
		</div>
		<!-- 用来展示报价明细条目列表的 -->
		<div id="enquiryDetail" style="display: none;">
			<table id="enquiryDetail-table" class="table table-bordered table-hover">
				<thead>
					<tr>
						<th>供应商</th>
						<th>产品名称</th>
						<th>物料编码</th>
						<th>规格型号</th>
						<th>单位</th>
						<th>数量</th>
						<th>单价</th>
						<th>总价</th>
						<th>备注</th>
					</tr>
				</thead>
				<tbody id="enquiryDetail-tbody"></tbody>
			</table>
		</div>
		<script>
			var subopenid;
			$(function() {
			});
			// 去新增询价
			function toEnquiry(oid) {
				postRequest($('#contextDiv').html() + '/orderHandle/toEnquiry/' + oid, {}, function(data) {
					subopenid = layer.open({
						type: 1,
						// skin: 'layui-layer-rim', //加上边框
						title: '审核订单',
						area: ['90%', '80%'], //宽高
						content: data
					})
				})
			}
			// 查看报价明细
			function showEnquiryDetail(eid) {
				postRequest($('#contextDiv').html() + '/enquiry/enquiryDetail/list/' + eid, {}, function(data) {
					$('#enquiryDetail-tbody').html(data)
					layer.open({
					  type: 1,
					  skin: 'layui-layer-rim', //加上边框
					  area: ['80%', '60%'], //宽高
					  content: $('#enquiryDetail').prop('outerHTML').replace("display: none;", "")
					});
				})
			}
			// 去维护报价单
			function toQuotation(oid) {
				postRequest($('#contextDiv').html() + '/quotation/toEdit', {oid: oid}, function(data) {
					subopenid = layer.open({
						type: 1,
						// skin: 'layui-layer-rim', //加上边框
						title: '报价单',
						area: ['70%', '60%'], //宽高
						content: data
					})
				})
			}
			// 去新增竞标方
			function toBidder(oid) {
				postRequest($('#contextDiv').html() + '/bidder/toEdit', {oid: oid}, function(data) {
					subopenid = layer.open({
						type: 1,
						// skin: 'layui-layer-rim', //加上边框
						title: '竞标方',
						area: ['70%', '60%'], //宽高
						content: data
					})
				})
			}
			// 去保证金
			function toDeposit(oid) {
				postRequest($('#contextDiv').html() + '/deposit/toEdit', {oid: oid}, function(data) {
					subopenid = layer.open({
						type: 1,
						// skin: 'layui-layer-rim', //加上边框
						title: '保证金',
						area: ['60%', '80%'], //宽高
						content: data
					})
				})
			}
			
			//// 编辑企业信息
			function toEnterprise(oid) {
				postRequest($('#contextDiv').html() + '/info/toEnterprise/' + oid, {}, function(data) {
					subopenid = layer.open({
						type: 1,
						// skin: 'layui-layer-rim', //加上边框
						title: '编辑企业信息',
						area: ['800px', '90%'], //宽高
						content: data
					})
				})
			}
			//// 编辑出资方
			function toFund(eid, fid) {
				postRequest($('#contextDiv').html() + '/info/toFund/' + eid, {
					fid: fid
				}, function(data) {
					subopenid = layer.open({
						type: 1,
						// skin: 'layui-layer-rim', //加上边框
						title: '编辑出资方信息',
						area: ['600px', '80%'], //宽高
						content: data
					})
				})
			}
			//// 编辑人员
			function toPerson(eid, pid) {
				postRequest($('#contextDiv').html() + '/info/toPerson/' + eid, {
					pid: pid
				}, function(data) {
					subopenid = layer.open({
						type: 1,
						// skin: 'layui-layer-rim', //加上边框
						title: '编辑人员信息',
						area: ['600px', '80%'], //宽高
						content: data
					})
				})
			}
			
			// 下载报价单或报价明细单
			function toDownloadAnnex (annexId) {
				window.location.href = $('#contextDiv').html() + '/quotation/downloadAnnex/'+ annexId
			}
			// 下载完结材料
			function toDownloadDoc (fid, idx) {
				window.location.href = $('#contextDiv').html() + '/filed/downloadDoc?fid='+ fid + '&idx=' + idx
			}
			// 下载完结材料
			function toDownloadOrderDoc (oid, idx) {
				window.location.href = $('#contextDiv').html() + '/order/downloadOrderDoc?oid='+ oid + '&idx=' + idx
			}
			
			
			// 关闭详情窗口打开的子窗口
			function closeSubWindow() {
				layer.close(subopenid);
			}
			function delFunder(eid, fid) {
				layer.confirm('确定删除此条出资信息？', {
					btn: ['确定', '取消'] //按钮
				}, function() {
					postRequest($('#contextDiv').html() + '/info/delFunder/' + fid, {}, function(data) {
						if (data.result) {
							layer.msg('操作成功')
							loadFunds(eid)
						} else {
							layer.msg(data.message)
						}
					})
				})
			}
			function loadFunds(eid) {
				postRequest($('#contextDiv').html() + '/info/funderList/' + eid, {}, function(data) {
					$('#fundTBody').html(data)
				})
			}
			function delPerson(eid, pid) {
				layer.confirm('确定删除人员信息？', {
					btn: ['确定', '取消'] //按钮
				}, function() {
					postRequest($('#contextDiv').html() + '/info/delPerson/' + pid, {}, function(data) {
						if (data.result) {
							layer.msg('操作成功')
							loadPersons(eid)
						} else {
							layer.msg(data.message)
						}
					})
				})
			}
			function loadPersons(eid) {
				postRequest($('#contextDiv').html() + '/info/personList/' + eid, {}, function(data) {
					$('#personTBody').html(data)
				})
			}
		</script>
	</body>
</html>
