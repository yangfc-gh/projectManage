<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
	</head>
	<body>
		<div class="page-content" style="margin-bottom: 50px; min-height: 800px;">
			<input type="hidden" name="oid" id="oid" th:value="${supplycontract.oid}" />
			<input type="hidden" name="scid" id="scid" th:value="${supplycontract.scid}" />
			<div id="accordion" class="panel-group">
				<div class="panel panel-default">
					<div class="panel-heading">
						<a class="accordion-toggle bolder" data-toggle="collapse" href="#collapseSupplycontract">
							<i class="ace-icon fa fa-angle-down bigger-110" data-icon-hide="ace-icon fa fa-angle-down" data-icon-show="ace-icon fa fa-angle-right"></i>
							&nbsp;供应合同 <span style="color: #B7B7B7;font-size: 12px;">(点击此处可收起)</span> 
						</a>
						<span class="pull-right">
							<button th:onclick="toSupplycontract([[${supplycontract.oid}]], [[${supplycontract.scid}]])" type="button" class="btn btn-mini btn-primary">修改供应合同</button>
						</span>
					</div>
											
					<div class="panel-collapse collapse in" id="collapseSupplycontract">
						<div class="panel-body">
							<div class="profile-user-info profile-user-info-striped">
								<div class="col-xs-6 col-sm-6 col-md-6 profile-info-row">
									<div class="profile-info-name"> 合同名称 </div>
									<div class="profile-info-value">
										<span class="" id="cname" th:text="${supplycontract.cname}"></span>
									</div>
								</div>
								<div class="col-xs-6 col-sm-6 col-md-6 profile-info-row">
									<div class="profile-info-name"> 合同号 </div>
									<div class="profile-info-value">
										<span class="" id="cno" th:text="${supplycontract.cno}"></span>
									</div>
								</div>
								<div class="col-xs-6 col-sm-6 col-md-6 profile-info-row">
									<div class="profile-info-name"> 合同金额 </div>
									<div class="profile-info-value">
										<span class="" id="amount" th:text="${supplycontract.amount}"></span>
									</div>
								</div>
								<div class="col-xs-6 col-sm-6 col-md-6 profile-info-row">
									<div class="profile-info-name"> 签订日期 </div>
									<div class="profile-info-value">
										<span class="" th:text="${supplycontract.signDate}"></span>
									</div>
								</div>
								<div class="col-xs-6 col-sm-6 col-md-6 profile-info-row">
									<div class="profile-info-name"> 甲方 </div>
									<div class="profile-info-value">
										<span class="" id="partya" th:text="${supplycontract.partya}"></span>
									</div>
								</div>
								<div class="col-xs-6 col-sm-6 col-md-6 profile-info-row">
									<div class="profile-info-name"> 乙方 </div>
									<div class="profile-info-value">
										<span class="" id="partyb" th:text="${supplycontract.partyb}"></span>
									</div>
								</div>
								<div class="col-xs-6 col-sm-6 col-md-6 profile-info-row">
									<div class="profile-info-name"> 附件 </div>
									<div class="profile-info-value">
										<span th:onclick="toDownloadSupplycontractAnnex([[${supplycontract.annexPath}]])" style="color: #007DDB;cursor: pointer;" title="点击下载"  th:text="${supplycontract.annexName}"></span>
									</div>
								</div>
								<div class="col-xs-6 col-sm-6 col-md-6 profile-info-row">
									<div class="profile-info-name"> 交付日期 </div>
									<div class="profile-info-value">
										<span class="" id="deliveryDate" th:text="${supplycontract.deliveryDate}"></span>
									</div>
								</div>
								<div class="col-xs-6 col-sm-6 col-md-6 profile-info-row">
									<div class="profile-info-name"> 送货单 </div>
									<div class="profile-info-value">
										<span th:onclick="toDownloadSupplycontractAnnex([[${supplycontract.deliveryPath}]])" style="color: #007DDB;cursor: pointer;" title="点击下载"  th:text="${supplycontract.deliveryName}"></span>
									</div>
								</div>
								<div class="col-xs-12 col-sm-12 col-md-12 profile-info-row">
									<div class="profile-info-name"> 概要 </div>
									<div class="profile-info-value">
										<span class="" id="description" th:text="${supplycontract.description}"></span>
									</div>
								</div>
								<div class="col-xs-12 col-sm-12 col-md-12 profile-info-row">
									<div class="profile-info-name"> 备注 </div>
									<div class="profile-info-value">
										<span class="" id="remark" th:text="${supplycontract.remark}"></span>
									</div>
								</div>
							</div>
							<div class="panel panel-default" style="margin: 5px 12px;">
								<div class="panel-heading">
									<a class="accordion-toggle collapsed" data-toggle="collapse" href="#collapseSCP">
										<i class="ace-icon fa fa-angle-down bigger-110" data-icon-hide="ace-icon fa fa-angle-down" data-icon-show="ace-icon fa fa-angle-right"></i>
										&nbsp;付款记录 <span style="color: #B7B7B7;font-size: 12px;">(点击此处可收起)</span> 
									</a>
									<span class="pull-right">
										<button th:onclick="toSupplycontractPayment([[${supplycontract.scid}]], null)" type="button" class="btn btn-mini btn-primary">添加付款记录</button>
									</span>
								</div>
								<div class="panel-collapse collapse in" id="collapseSCP">
									<div class="panel-body">
										<div id="scpayment-div" style="padding: 2px 12px;">
											<table id="scpayment-table" class="table table-bordered table-hover">
												<thead>
													<tr>
														<th>金额</th>
														<th>支付日期</th>
														<th>支付方式</th>
														<th>支付主体</th>
														<th>票据</th>
														<th>备注</th>
														<th></th>
													</tr>
												</thead>
												<tbody th:id="'payment-tbody'+${supplycontract.scid}">
													<tr th:each="payment, state: ${supplycontract.payments}">
														<td th:text="${payment.amount}"></td>
														<td th:text="${payment.payDate}"></td>
														<td th:text="${payment.payMode}"></td>
														<td th:text="${payment.payCorporate}"></td>
														<td>
															<span th:onclick="toDownloadSupplycontractPaymentAnnex([[${payment.billPath}]])" style="color: #007DDB;cursor: pointer;" title="点击下载" th:text="${payment.billName}"></span>
														</td>
														<td th:text="${payment.remark}"></td>
														<td>
															<button th:onclick="toSupplycontractPayment([[${payment.scid}]], [[${payment.pid}]])" class="btn btn-primary btn-mini">修改</button>
															<button th:onclick="delSupplycontractPayment([[${payment.scid}]], [[${payment.pid}]])" class="btn btn-danger btn-white btn-mini">删除</button>
														</td>
													</tr>
												</tbody>
											</table>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div class="footBtn">
			<div class="container-fluid">
				<div class="row">
					<div class="col-xs-5 col-sm-5 col-md-5"></div>
					<div class="">
						<button class="btn btn-white btn-default" onclick="closeOpen()"> 关 &nbsp; 闭</button>
					</div>
				</div>
			</div>
		</div>
		<script>
			var subopenid;
			$(function() {
			});
			// 关闭详情窗口打开的子窗口
			function closeSubWindow() {
				layer.close(subopenid);
			}
			// 去新增供应合同
			function toSupplycontract(oid, scid) {
				postRequest($('#contextDiv').html() + '/supplycontract/toEdit', {oid:oid, scid:scid}, function(data) {
					subopenid = layer.open({
						type: 1,
						// skin: 'layui-layer-rim', //加上边框
						title: '供应合同',
						area: ['60%', '80%'], //宽高
						content: data
					})
				})
			}
			// 去付款记录
			function toSupplycontractPayment(scid, pid) {
				postRequest($('#contextDiv').html() + '/supplycontract/payment/toEdit', {scid:scid, pid:pid}, function(data) {
					subopenid = layer.open({
						type: 1,
						// skin: 'layui-layer-rim', //加上边框
						title: '供应合同付款记录',
						area: ['60%', '80%'], //宽高
						content: data
					})
				})
			}
			// 删除供应合同付款记录
			function delSupplycontractPayment(scid, pid) {
				layer.confirm('确定删除此条供应合同付款记录吗？', {
					btn: ['确定', '取消'] //按钮
				}, function() {
					postRequest($('#contextDiv').html() + '/supplycontract/payment/del/' + pid, {}, function(data) {
						if (data.result) {
							layer.msg('操作成功')
							loadSupplycontractpayment(scid)
						} else {
							layer.msg(data.message)
						}
					})
				})
			}
			// 投标保证金重新加载
			function loadSupplycontractpayment(scid) {
				postRequest($('#contextDiv').html() + '/supplycontract/payment/list', {scid:scid}, function(data) {
					$('#payment-tbody'+scid).html(data)
				})
			}
			// 供应合同附件
			function toDownloadSupplycontractAnnex (annexId) {
				window.location.href = $('#contextDiv').html() + '/supplycontract/downloadAnnex/'+ annexId
			}
			// 供应合同付款票据附件
			function toDownloadSupplycontractPaymentAnnex (annexId) {
				window.location.href = $('#contextDiv').html() + '/supplycontract/payment/downloadAnnex/'+ annexId
			}
		</script>
	</body>
</html>
